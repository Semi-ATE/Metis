import inotify.adapters
import os
import sys
import gi
import time
from yaml import safe_load, dump 
import threading

gi.require_version('Gst', '1.0')
from gi.repository import Gst, GLib, GObject


                
def _main():

    Gst.init(None)

    # create the elements
    source = Gst.ElementFactory.make("test_source", "test_source")
    if not source:
        print("ERROR: Can not find source plugin")
        sys.exit(1)
        
    mid = Gst.ElementFactory.make("test_mid", "test_mid")
    if not mid:
        print("ERROR: Can not find mid plugin")
        sys.exit(1)

    sink = Gst.ElementFactory.make("test_sink", "test_sink")
    if not sink:
        print("ERROR: Can not find sink plugin")
        sys.exit(1)

    # create the empty pipeline
    pipeline = Gst.Pipeline.new("test-pipeline")
    

    if not pipeline:
        print("ERROR: Can not create pipeline")
        sys.exit(1)

    source.set_pipeline(pipeline)

    # build the pipeline
    pipeline.add(source, mid, sink)
    if not source.link(mid):
        print("ERROR: Could not link source to mid")
        sys.exit(1)

    if not mid.link(sink):
        print("ERROR: Could not link mid to sink")
        sys.exit(1)


if __name__ == '__main__':
    _main()

